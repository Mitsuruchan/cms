{"filter":false,"title":"TeamController.php","tooltip":"/cms/app/Http/Controllers/TeamController.php","undoManager":{"mark":27,"position":27,"stack":[[{"start":{"row":0,"column":0},"end":{"row":10,"column":0},"action":"remove","lines":["<?php","","namespace App\\Http\\Controllers;","","use Illuminate\\Http\\Request;","","class TeamController extends Controller","{","    //","}",""],"id":2},{"start":{"row":0,"column":0},"end":{"row":17,"column":1},"action":"insert","lines":["<?php","","namespace App\\Http\\Controllers;","","use Illuminate\\Http\\Request;","use App\\Models\\Team; //この行を上に追加","use App\\Models\\User;//この行を上に追加","use Auth;//この行を上に追加","use Validator;//この行を上に追加","","","class TeamsController extends Controller","{","    public function index()","    {","        return view('teams');","    }  ","}"]}],[{"start":{"row":3,"column":0},"end":{"row":4,"column":0},"action":"remove","lines":["",""],"id":3}],[{"start":{"row":12,"column":27},"end":{"row":13,"column":0},"action":"insert","lines":["",""],"id":8},{"start":{"row":13,"column":0},"end":{"row":13,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":16,"column":7},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":10},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":17,"column":4},"end":{"row":39,"column":1},"action":"insert","lines":["public function store(Request $request){","","    //バリデーション ","    $validator = Validator::make($request->all(), [","        'team_name' => 'required|max:255'","    ]);","    ","    //バリデーション:エラー","    if ($validator->fails()) {","        return redirect('/')","            ->withInput()","            ->withErrors($validator);","    }","    ","    //以下に登録処理を記述（Eloquentモデル）","    $teams = new Team;","    $teams->team_name = $request->team_name;","    $teams->user_id = Auth::id();//ここでログインしているユーザidを登録しています","    $teams->save();","    ","    return redirect('/teams');","","}"],"id":11}],[{"start":{"row":14,"column":5},"end":{"row":15,"column":0},"action":"insert","lines":["",""],"id":12},{"start":{"row":15,"column":0},"end":{"row":15,"column":8},"action":"insert","lines":["        "]},{"start":{"row":15,"column":8},"end":{"row":16,"column":0},"action":"insert","lines":["",""]},{"start":{"row":16,"column":0},"end":{"row":16,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":15,"column":0},"end":{"row":17,"column":29},"action":"remove","lines":["        ","        ","        return view('teams');"],"id":13},{"start":{"row":15,"column":0},"end":{"row":22,"column":21},"action":"insert","lines":["  //** ↓ 下をコピー ↓ **    ","    ","\t\t//本の全件データ取得","    $teams = Team::get();","","    return view('teams',['teams'=>$teams]);","    ","    //** ↑ 上をコピー ↑ **"]}],[{"start":{"row":18,"column":3},"end":{"row":18,"column":4},"action":"insert","lines":[" "],"id":14}],[{"start":{"row":19,"column":0},"end":{"row":19,"column":4},"action":"insert","lines":["    "],"id":15}],[{"start":{"row":20,"column":3},"end":{"row":20,"column":4},"action":"insert","lines":[" "],"id":16}],[{"start":{"row":0,"column":0},"end":{"row":47,"column":1},"action":"remove","lines":["<?php","","namespace App\\Http\\Controllers;","use Illuminate\\Http\\Request;","use App\\Models\\Team; //この行を上に追加","use App\\Models\\User;//この行を上に追加","use Auth;//この行を上に追加","use Validator;//この行を上に追加","","","class TeamsController extends Controller","{","    public function index()","    ","    {","  //** ↓ 下をコピー ↓ **    ","    ","\t\t//本の全件データ取得","     $teams = Team::get();","    ","     return view('teams',['teams'=>$teams]);","    ","    //** ↑ 上をコピー ↑ **","    }  ","    public function store(Request $request){","","    //バリデーション ","    $validator = Validator::make($request->all(), [","        'team_name' => 'required|max:255'","    ]);","    ","    //バリデーション:エラー","    if ($validator->fails()) {","        return redirect('/')","            ->withInput()","            ->withErrors($validator);","    }","    ","    //以下に登録処理を記述（Eloquentモデル）","    $teams = new Team;","    $teams->team_name = $request->team_name;","    $teams->user_id = Auth::id();//ここでログインしているユーザidを登録しています","    $teams->save();","    ","    return redirect('/teams');","","}","}"],"id":17}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":13},"action":"insert","lines":["npm run build"],"id":18}],[{"start":{"row":0,"column":12},"end":{"row":0,"column":13},"action":"remove","lines":["d"],"id":19},{"start":{"row":0,"column":11},"end":{"row":0,"column":12},"action":"remove","lines":["l"]},{"start":{"row":0,"column":10},"end":{"row":0,"column":11},"action":"remove","lines":["i"]},{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"remove","lines":["u"]},{"start":{"row":0,"column":8},"end":{"row":0,"column":9},"action":"remove","lines":["b"]},{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"remove","lines":[" "]},{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"remove","lines":["n"]},{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"remove","lines":["u"]},{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"remove","lines":["r"]},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"remove","lines":[" "]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"remove","lines":["m"]},{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"remove","lines":["p"]},{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":["n"]},{"start":{"row":0,"column":0},"end":{"row":0,"column":13},"action":"insert","lines":["npm run build"]}],[{"start":{"row":0,"column":12},"end":{"row":0,"column":13},"action":"remove","lines":["d"],"id":20},{"start":{"row":0,"column":11},"end":{"row":0,"column":12},"action":"remove","lines":["l"]},{"start":{"row":0,"column":10},"end":{"row":0,"column":11},"action":"remove","lines":["i"]},{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"remove","lines":["u"]},{"start":{"row":0,"column":8},"end":{"row":0,"column":9},"action":"remove","lines":["b"]},{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"remove","lines":[" "]},{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"remove","lines":["n"]},{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"remove","lines":["u"]},{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"remove","lines":["r"]},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"remove","lines":[" "]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"remove","lines":["m"]},{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"remove","lines":["p"]},{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"remove","lines":["n"]}],[{"start":{"row":0,"column":0},"end":{"row":17,"column":1},"action":"insert","lines":["<?php","","namespace App\\Http\\Controllers;","","use Illuminate\\Http\\Request;","use App\\Models\\Team; //この行を上に追加","use App\\Models\\User;//この行を上に追加","use Auth;//この行を上に追加","use Validator;//この行を上に追加","","","class TeamsController extends Controller","{","    public function index()","    {","        return view('teams');","    }  ","}"],"id":21}],[{"start":{"row":16,"column":7},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":22},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":17,"column":4},"end":{"row":39,"column":1},"action":"insert","lines":["public function store(Request $request){","","    //バリデーション ","    $validator = Validator::make($request->all(), [","        'team_name' => 'required|max:255'","    ]);","    ","    //バリデーション:エラー","    if ($validator->fails()) {","        return redirect('/')","            ->withInput()","            ->withErrors($validator);","    }","    ","    //以下に登録処理を記述（Eloquentモデル）","    $teams = new Team;","    $teams->team_name = $request->team_name;","    $teams->user_id = Auth::id();//ここでログインしているユーザidを登録しています","    $teams->save();","    ","    return redirect('/teams');","","}"],"id":23}],[{"start":{"row":39,"column":1},"end":{"row":39,"column":2},"action":"insert","lines":["c"],"id":24},{"start":{"row":39,"column":2},"end":{"row":39,"column":3},"action":"insert","lines":["l"]},{"start":{"row":39,"column":3},"end":{"row":39,"column":4},"action":"insert","lines":["e"]},{"start":{"row":39,"column":4},"end":{"row":39,"column":5},"action":"insert","lines":["a"]},{"start":{"row":39,"column":5},"end":{"row":39,"column":6},"action":"insert","lines":["r"]}],[{"start":{"row":39,"column":5},"end":{"row":39,"column":6},"action":"remove","lines":["r"],"id":25},{"start":{"row":39,"column":4},"end":{"row":39,"column":5},"action":"remove","lines":["a"]},{"start":{"row":39,"column":3},"end":{"row":39,"column":4},"action":"remove","lines":["e"]},{"start":{"row":39,"column":2},"end":{"row":39,"column":3},"action":"remove","lines":["l"]},{"start":{"row":39,"column":1},"end":{"row":39,"column":2},"action":"remove","lines":["c"]}],[{"start":{"row":13,"column":4},"end":{"row":13,"column":27},"action":"remove","lines":["public function index()"],"id":26},{"start":{"row":13,"column":4},"end":{"row":22,"column":1},"action":"insert","lines":["public function index() {","   //** ↓ 下をコピー ↓ **    ","    ","\t\t//本の全件データ取得","    $teams = Team::get();","","    return view('teams',['teams'=>$teams]);","    ","    //** ↑ 上をコピー ↑ **","}"]}],[{"start":{"row":23,"column":4},"end":{"row":23,"column":5},"action":"remove","lines":["{"],"id":27}],[{"start":{"row":23,"column":0},"end":{"row":23,"column":4},"action":"remove","lines":["    "],"id":28},{"start":{"row":22,"column":1},"end":{"row":23,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":22,"column":0},"end":{"row":22,"column":1},"action":"remove","lines":["}"],"id":29},{"start":{"row":21,"column":21},"end":{"row":22,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":0,"column":0},"end":{"row":47,"column":1},"action":"remove","lines":["<?php","","namespace App\\Http\\Controllers;","","use Illuminate\\Http\\Request;","use App\\Models\\Team; //この行を上に追加","use App\\Models\\User;//この行を上に追加","use Auth;//この行を上に追加","use Validator;//この行を上に追加","","","class TeamsController extends Controller","{","    public function index() {","   //** ↓ 下をコピー ↓ **    ","    ","\t\t//本の全件データ取得","    $teams = Team::get();","","    return view('teams',['teams'=>$teams]);","    ","    //** ↑ 上をコピー ↑ **","        return view('teams');","    }  ","    public function store(Request $request){","","    //バリデーション ","    $validator = Validator::make($request->all(), [","        'team_name' => 'required|max:255'","    ]);","    ","    //バリデーション:エラー","    if ($validator->fails()) {","        return redirect('/')","            ->withInput()","            ->withErrors($validator);","    }","    ","    //以下に登録処理を記述（Eloquentモデル）","    $teams = new Team;","    $teams->team_name = $request->team_name;","    $teams->user_id = Auth::id();//ここでログインしているユーザidを登録しています","    $teams->save();","    ","    return redirect('/teams');","","}","}"],"id":30},{"start":{"row":0,"column":0},"end":{"row":102,"column":1},"action":"insert","lines":["<?php","","namespace App\\Http\\Controllers;","","use Illuminate\\Http\\Request;","use App\\Models\\Team;//チームモデルを使う","use App\\Models\\User;//ユーザーモデルを使う","use Auth;//ログイン認証の機能を使う","use Validator;//バリデーション機能を使う","","class TeamController extends Controller","{","    //トップページ表示処理","    public function index(){","        ","        //チームのデータ全件取得","        $teams = Team::get();","        ","        return view('teams',[ 'teams' => $teams ]);","    }","    ","    ","    //登録処理","    public function store(Request $request){","        ","        //バリデーション ","        $validator = Validator::make($request->all(), [","            'team_name' => 'required|max:255'","        ]);","        ","        //バリデーション:エラー","        if ($validator->fails()) {","            return redirect('/')","                ->withInput()","                ->withErrors($validator);","        }","        ","        //以下に登録処理を記述（Eloquentモデル）","        $teams = new Team;","        $teams->team_name = $request->team_name;","        $teams->user_id = Auth::id();//ここでログインしているユーザidを登録しています","        $teams->save();","        ","        //中間テーブルにリレーション登録","        $teams->members()->attach( Auth::user(),['role'=>'owner'] );","        ","        return redirect('/teams');","        ","    }","    ","    ","    //チーム参加処理","    public function join($team_id){","        ","        //ログイン中のユーザーを取得","        $user = Auth::user();","        ","        //参加したいチームを取得","        $team = Team::find($team_id);","        ","        //中間テーブルに保存（リレーション登録）","        $team->members()->attach($user);","        ","        return redirect('/teams');","        ","        ","    }","    ","    //チーム編集詳細画面表示処理","    public function edit(Team $team){","        ","        return view('teamsedit',[ 'team' => $team ]);","        ","    }","    ","    //更新処理（チーム名変更）","    //更新処理","    public function update (Request $request) {","            ","             //バリデーション ","            $validator = Validator::make($request->all(), [","                'team_name' => 'required|max:255',","            ]);","            ","            //バリデーション:エラー","            if ($validator->fails()) {","                return redirect('/')","                    ->withInput()","                    ->withErrors($validator);","            }","            ","            //対象のチームを取得","            $team = Team::find($request->id);","            $team->team_name = $request->team_name;","            $team->save();","            ","            return redirect('/teams');","            ","    }","    ","    ","    ","}"]}],[{"start":{"row":102,"column":1},"end":{"row":102,"column":2},"action":"insert","lines":["c"],"id":31},{"start":{"row":102,"column":2},"end":{"row":102,"column":3},"action":"insert","lines":["d"]}],[{"start":{"row":102,"column":2},"end":{"row":102,"column":3},"action":"remove","lines":["d"],"id":32},{"start":{"row":102,"column":1},"end":{"row":102,"column":2},"action":"remove","lines":["c"]}],[{"start":{"row":37,"column":7},"end":{"row":46,"column":34},"action":"remove","lines":[" //以下に登録処理を記述（Eloquentモデル）","        $teams = new Team;","        $teams->team_name = $request->team_name;","        $teams->user_id = Auth::id();//ここでログインしているユーザidを登録しています","        $teams->save();","        ","        //中間テーブルにリレーション登録","        $teams->members()->attach( Auth::user(),['role'=>'owner'] );","        ","        return redirect('/teams');"],"id":33},{"start":{"row":37,"column":7},"end":{"row":46,"column":30},"action":"insert","lines":["//以下に登録処理を記述（Eloquentモデル）","    $teams = new Team;","    $teams->team_name = $request->team_name;","    $teams->user_id = Auth::id();//ここでログインしているユーザidを登録しています","    $teams->save();","    ","    //多対多のリレーションもここで登録","    $teams->members()->attach( Auth::user(),['role'=>'owner'] );//<-ここが変わってるよ！！","    ","    return redirect('/teams');"]}],[{"start":{"row":38,"column":0},"end":{"row":38,"column":4},"action":"insert","lines":["    "],"id":34},{"start":{"row":39,"column":0},"end":{"row":39,"column":4},"action":"insert","lines":["    "]},{"start":{"row":40,"column":0},"end":{"row":40,"column":4},"action":"insert","lines":["    "]},{"start":{"row":41,"column":0},"end":{"row":41,"column":4},"action":"insert","lines":["    "]},{"start":{"row":42,"column":0},"end":{"row":42,"column":4},"action":"insert","lines":["    "]},{"start":{"row":43,"column":0},"end":{"row":43,"column":4},"action":"insert","lines":["    "]},{"start":{"row":44,"column":0},"end":{"row":44,"column":4},"action":"insert","lines":["    "]},{"start":{"row":45,"column":0},"end":{"row":45,"column":4},"action":"insert","lines":["    "]},{"start":{"row":46,"column":0},"end":{"row":46,"column":4},"action":"insert","lines":["    "]}]]},"ace":{"folds":[],"scrolltop":547.000019264221,"scrollleft":0,"selection":{"start":{"row":49,"column":4},"end":{"row":49,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":38,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1676203075636,"hash":"65e8952823f2e21b042a7c014e09aedff9805cf5"}